"use strict";(()=>{var e={};e.id=315,e.ids=[315],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3735:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>$,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var i={};r.r(i),r.d(i,{GET:()=>d,POST:()=>u,dynamic:()=>p});var o=r(921),a=r(7380),n=r(4185),s=r(3878),l=r(9382);let p="force-dynamic";async function c(e){try{console.log(`Fetching real-time prices for new item: ${e}`);let t=process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000",r=await fetch(`${t}/api/real-time-prices?item=${encodeURIComponent(e)}`,{cache:"no-store",headers:{"Content-Type":"application/json"}});if(!r.ok)throw Error(`Failed to fetch real-time prices: ${r.status} ${r.statusText}`);let i=await r.json();if(!Array.isArray(i)||0===i.length)throw Error("Invalid price data received");return console.log(`Successfully fetched prices for ${e} from ${i.length} platforms`),i}catch(t){return console.error("Error fetching real-time prices:",t),function(e){console.log(`Generating fallback prices for: ${e}`);let t=[],r=e.toLowerCase().trim(),i=0;for(let e=0;e<r.length;e++)i+=r.charCodeAt(e);for(let r of(i=i%450+50,["Amazon","BigBasket","Blinkit","JioMart"])){let o=i;"Amazon"===r&&(o*=.95+.2*Math.random()),"BigBasket"===r&&(o*=.9+.25*Math.random()),"Blinkit"===r&&(o*=1.05+.15*Math.random()),"JioMart"===r&&(o*=.85+.3*Math.random()),o=Math.round(100*o)/100;let a=Math.random()>.1;t.push({platform:r,price:o,available:a,url:`https://www.${r.toLowerCase()}.com/search?q=${encodeURIComponent(e)}`,productName:`${r} ${e}`,imageUrl:null})}let o=new Set;return t.forEach(e=>{for(;o.has(e.price);)e.price=Math.round(e.price*(1+(.05*Math.random()-.025))*100)/100;o.add(e.price)}),console.log(`Generated fallback prices for ${e}:`,t.map(e=>`${e.platform}: â‚¹${e.price}`).join(", ")),t}(e)}}async function d(e,{params:t}){try{console.log(`Fetching items for shopping list: ${t.id}`);let e=await l._.shoppingItem.findMany({where:{shoppingListId:t.id},include:{prices:!0},orderBy:{createdAt:"desc"}});return console.log(`Found ${e.length} items with ${e.reduce((e,t)=>e+(t.prices?.length||0),0)} total prices`),s.NextResponse.json(e)}catch(e){return console.error("Error fetching items:",e),s.NextResponse.json({error:"Failed to fetch items"},{status:500})}}async function u(e,{params:t}){try{let{name:r,quantity:i,unit:o}=await e.json();if(!r)return s.NextResponse.json({error:"Name is required"},{status:400});console.log(`Creating new item: ${r} in shopping list: ${t.id}`);let a=await l._.shoppingItem.create({data:{name:r,quantity:i||1,unit:o||null,shoppingListId:t.id}}),n=await c(r);if(n&&Array.isArray(n)&&n.length>0){let e=n.map(e=>({platform:e.platform,price:e.price,available:e.available,url:e.url,productName:e.productName,imageUrl:e.imageUrl,shoppingItemId:a.id,lastUpdated:new Date}));await l._.itemPrice.createMany({data:e}),console.log(`Created ${e.length} price entries for item: ${r}`)}else console.error(`Failed to create price entries for item: ${r}`);let p=await l._.shoppingItem.findUnique({where:{id:a.id},include:{prices:!0}});return s.NextResponse.json(p)}catch(e){return console.error("Error creating item:",e),s.NextResponse.json({error:"Failed to create item"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/shopping-lists/[id]/items/route",pathname:"/api/shopping-lists/[id]/items",filename:"route",bundlePath:"app/api/shopping-lists/[id]/items/route"},resolvedPagePath:"/home/ubuntu/grocery_price_comparison/app/app/api/shopping-lists/[id]/items/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:f}=m,w="/api/shopping-lists/[id]/items/route";function $(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},9382:(e,t,r)=>{r.d(t,{_:()=>o});let i=require("@prisma/client"),o=global.prisma||new i.PrismaClient({log:["query"]})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[923,146],()=>r(3735));module.exports=i})();